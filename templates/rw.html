<div class="row">
    <div class="col-xl-12 col-xs-12">
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">操作记录</h6>
            </div>
            <div class="card-body table-responsive mx-table">
                {if $error_message}
                    <div class="alert alert-danger">{$error_message}</div>
                {elseif empty($tasks)}
                    <p>当前没有操作记录。</p>
                {else}
                <table class="table table-hover t-text-dark--light-15 sm-text">
                    <thead>
                    <tr>
                        <th>任务ID (UPID)</th>
                        <th>类型</th>
                        <th>状态</th>
                        <th>发起用户</th>
                        <th>开始时间</th>
                        <th>结束时间</th>
                    </tr>
                    </thead>
                    <tbody class="t-mt-15">
                    {foreach $tasks as $task}
                    <tr>
                        <td>{$task.upid|default:$task.id}</td>
                        <td>
                            {if $task.type == 'lxcstart'}开机
                            {elseif $task.type == 'lxcstop'}强制关机
                            {elseif $task.type == 'lxcshutdown'}正常关机
                            {elseif $task.type == 'lxcreboot'}重启
                            {elseif $task.type == 'lxcsnapshot'}创建快照
                            {elseif $task.type == 'lxcrollback'}回滚快照
                            {elseif $task.type == 'lxcdelete'}删除快照
                            {elseif $task.type == 'lxccreate'}创建容器
                            {elseif $task.type == 'destroy'}删除容器
                            {elseif $task.type == 'vncshell'}控制台
                            {else}{$task.type}{/if}
                        </td>
                        <td>
                            {if $task.status == 'OK' || $task.exitstatus == 'OK'}
                            <label class="badge badge-success">成功</label>
                            {elseif $task.status == 'running'}
                            <label class="badge badge-info">进行中</label>
                            {else}
                            <label class="badge badge-danger">{$task.status|default:$task.exitstatus|default:'失败'}</label>
                            {/if}
                        </td>
                        <td>{$task.user}</td>
                        <td>{if $task.starttime}{$task.starttime|date_format:"%Y-%m-%d %H:%M:%S"}{else}N/A{/if}</td>
                        <td>{if $task.endtime && $task.status != 'running'}{$task.endtime|date_format:"%Y-%m-%d %H:%M:%S"}{else}-{/if}</td>
                    </tr>
                    {/foreach}
                    </tbody>
                </table>
                {/if}
            </div>
        </div>
    </div>
</div>
